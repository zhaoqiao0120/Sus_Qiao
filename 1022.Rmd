---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(networkD3)
library(sf)          # classes and functions for vector data
library(raster)      # classes and functions for raster data
library(spData)        # load geographic data
library(dplyr)
library(stringr) # for working with strings (pattern matching)
library(spDataLarge)   # load larger geographic data
library(stplanr)      # geographic transport data package
library(tmap) 
library(spData)        # load geographic data
library(dplyr)
library(stringr) # for working with strings (pattern matching)
library(spDataLarge)   # load larger geographic data
library(stplanr)      # geographic transport data package
library(tmap)     
```

#Montreal CT
```{r}
load("Data/CT.Rdata")
load("Data/zones_data.Rdata")
zones <- zones_data
Montral <- CT[CT@data$CMANAME == "Montral",]
Island <- Montral[,(2:5)] 
Montreal2 <- Montral[,(2:5)] 
Montreal <- Montral[,(2:5)] 
head(zones)
```
#Montreal flow data
```{r}
Origin <- Montral[,(2:5)]
Origin@data <- Origin@data %>%
  rename(Origin = CTUID)

Dest <- Montral[,(2:5)]
Dest@data <- Dest@data %>%
  rename(Dest = CTUID)

zones@data = left_join(zones@data,Origin@data, by = "Origin")
zones@data = left_join(zones@data, Dest@data, by = "Dest")

names(zones)
zones <- zones[(zones@data$CMANAME.x == "Montral" & zones@data$CMANAME.y == "Montral"),]
head(zones)
```

#Montreal CT Flow
```{r}
zones_total <- zones_data[,(1:13)]
names(zones_total)
zones_ori= zones_total@data %>%
  group_by(Origin) %>%
  summarize_if(is.numeric,sum) %>%
  dplyr::rename(CTUID = Origin, Tot_Ori = M_Tot)
zones_ori[1:10,]
zones_des= zones_total@data %>%
  group_by(Dest) %>%
  summarize_if(is.numeric,sum) %>%
  dplyr::rename(CTUID = Dest,Tot_Des = M_Tot)

Montreal@data = left_join(Montreal@data, zones_ori, by = "CTUID")
Montreal@data = left_join(Montreal@data, zones_des, by = "CTUID")

qtm(Montreal,"Tot_Des")
```
#TOP 5
```{r}
od_top5 = zones@data %>% 
  arrange(desc(M_Tot)) %>% 
  top_n(5, wt = M_Tot)
```

#Intra Inter
```{r}
zones_intra <- zones
zones_inter <- zones
zones_intra = filter(zones_intra@data, Origin == Dest)
zones_inter = filter(zones_inter@data, Origin != Dest)

zones_inter <- zones_inter[,-(1:2)]
MontrealNew <- Montral[,-1]
MontrealNew <- MontrealNew[,-(2:68)]
desire_lines = od2line(zones_inter, MontrealNew)
qtm(od_top50, lines.lwd = "M_Tot")
Montral <- st_as_sf(Montral)
names(MontrealNew)

od_top50 = desire_lines %>% 
  arrange(desc(M_Tot)) %>% 
  top_n(50, wt = M_Tot)
```


```{r}
lin <- as(Montral, "SpatialLinesDataFrame")  
## start here for lines
pts <- as.data.frame(as(lin, "SpatialPointsDataFrame"))
```

```{r}
from <- c(-1.55, 53.80) # geo_code("leeds")
to <- c(-1.76, 53.80) # geo_code("bradford uk")
json_output <- route_cyclestreet(from = from, to = to, plan = "quietest", save_raw = TRUE)
str(json_output) # what does cyclestreets give you?
rf_lb <- route_cyclestreet(from, to, plan = "fastest")
rf_lb@data
plot(rf_lb)
(rf_lb$length / (1000 * 1.61)) / # distance in miles
  (rf_lb$time / (60 * 60)) # time in hours - average speed here: ~8mph
# Plan a 'balanced' route from Pedaller's Arms to the University of Leeds
rb_pa <- route_cyclestreet("Pedaller's Arms, Leeds", "University of Leeds, UK", "balanced")

## End(Not run)
```

